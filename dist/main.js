"use strict";(()=>{var l={id:"acode.python.fmt",name:"Ruff Python Formatter",main:"main.js",version:"0.1.2",readme:"readme.md",icon:"icon.png",files:[],minVersionCode:290,license:"MIT",changelogs:"changelogs.md",keywords:["python","fmt","ruff","formatter"],price:0,author:{name:"Raunak",email:"raunak@bajrangcoder.dev",github:"bajrangCoder"}};var R={},o,g=0,p=null;function k(){return(p===null||p.byteLength===0)&&(p=new Uint8Array(o.memory.buffer)),p}var x=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},E=typeof x.encodeInto=="function"?function(n,e){return x.encodeInto(n,e)}:function(n,e){let t=x.encode(n);return e.set(t),{read:n.length,written:t.length}};function d(n,e,t){if(t===void 0){let a=x.encode(n),c=e(a.length,1)>>>0;return k().subarray(c,c+a.length).set(a),g=a.length,c}let r=n.length,i=e(r,1)>>>0,s=k(),_=0;for(;_<r;_++){let a=n.charCodeAt(_);if(a>127)break;s[i+_]=a}if(_!==r){_!==0&&(n=n.slice(_)),i=t(i,r,r=_+n.length*3,1)>>>0;let a=k().subarray(i+_,i+r),c=E(n,a);_+=c.written,i=t(i,r,_,1)>>>0}return g=_,i}var w=null;function f(){return(w===null||w.buffer.detached===!0||w.buffer.detached===void 0&&w.buffer!==o.memory.buffer)&&(w=new DataView(o.memory.buffer)),w}function $(n){let e=o.__externref_table_alloc();return o.__wbindgen_export_4.set(e,n),e}function h(n,e){try{return n.apply(this,e)}catch(t){let r=$(t);o.__wbindgen_exn_store(r)}}var j=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&j.decode();function u(n,e){return n=n>>>0,j.decode(k().subarray(n,n+e))}function m(n){return n==null}function v(n){let e=typeof n;if(e=="number"||e=="boolean"||n==null)return`${n}`;if(e=="string")return`"${n}"`;if(e=="symbol"){let i=n.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){let i=n.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(n)){let i=n.length,s="[";i>0&&(s+=v(n[0]));for(let _=1;_<i;_++)s+=", "+v(n[_]);return s+="]",s}let t=/\[object ([^\]]+)\]/.exec(toString.call(n)),r;if(t&&t.length>1)r=t[1];else return toString.call(n);if(r=="Object")try{return"Object("+JSON.stringify(n)+")"}catch{return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:r}function b(n){let e=o.__wbindgen_export_4.get(n);return o.__externref_table_dealloc(n),e}var I=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>o.__wbg_workspace_free(n>>>0,1)),S=class{__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,I.unregister(this),e}free(){let e=this.__destroy_into_raw();o.__wbg_workspace_free(e,0)}static version(){let e,t;try{let r=o.workspace_version();return e=r[0],t=r[1],u(r[0],r[1])}finally{o.__wbindgen_free(e,t,1)}}constructor(e){let t=o.workspace_new(e);if(t[2])throw b(t[1]);return this.__wbg_ptr=t[0]>>>0,I.register(this,this.__wbg_ptr,this),this}static defaultSettings(){let e=o.workspace_defaultSettings();if(e[2])throw b(e[1]);return b(e[0])}check(e){let t=d(e,o.__wbindgen_malloc,o.__wbindgen_realloc),r=g,i=o.workspace_check(this.__wbg_ptr,t,r);if(i[2])throw b(i[1]);return b(i[0])}format(e){let t,r;try{let _=d(e,o.__wbindgen_malloc,o.__wbindgen_realloc),a=g,c=o.workspace_format(this.__wbg_ptr,_,a);var i=c[0],s=c[1];if(c[3])throw i=0,s=0,b(c[2]);return t=i,r=s,u(i,s)}finally{o.__wbindgen_free(t,r,1)}}format_ir(e){let t,r;try{let _=d(e,o.__wbindgen_malloc,o.__wbindgen_realloc),a=g,c=o.workspace_format_ir(this.__wbg_ptr,_,a);var i=c[0],s=c[1];if(c[3])throw i=0,s=0,b(c[2]);return t=i,r=s,u(i,s)}finally{o.__wbindgen_free(t,r,1)}}comments(e){let t,r;try{let _=d(e,o.__wbindgen_malloc,o.__wbindgen_realloc),a=g,c=o.workspace_comments(this.__wbg_ptr,_,a);var i=c[0],s=c[1];if(c[3])throw i=0,s=0,b(c[2]);return t=i,r=s,u(i,s)}finally{o.__wbindgen_free(t,r,1)}}parse(e){let t,r;try{let _=d(e,o.__wbindgen_malloc,o.__wbindgen_realloc),a=g,c=o.workspace_parse(this.__wbg_ptr,_,a);var i=c[0],s=c[1];if(c[3])throw i=0,s=0,b(c[2]);return t=i,r=s,u(i,s)}finally{o.__wbindgen_free(t,r,1)}}tokens(e){let t,r;try{let _=d(e,o.__wbindgen_malloc,o.__wbindgen_realloc),a=g,c=o.workspace_tokens(this.__wbg_ptr,_,a);var i=c[0],s=c[1];if(c[3])throw i=0,s=0,b(c[2]);return t=i,r=s,u(i,s)}finally{o.__wbindgen_free(t,r,1)}}};async function F(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(r){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}let t=await n.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{let t=await WebAssembly.instantiate(n,e);return t instanceof WebAssembly.Instance?{instance:t,module:n}:t}}function q(){let n={};return n.wbg={},n.wbg.__wbg_String_8f0eb39a4a4c2f66=function(e,t){let r=String(t),i=d(r,o.__wbindgen_malloc,o.__wbindgen_realloc),s=g;f().setInt32(e+4*1,s,!0),f().setInt32(e+4*0,i,!0)},n.wbg.__wbg_buffer_609cc3eee51ed158=function(e){return e.buffer},n.wbg.__wbg_call_672a4d21634d4a24=function(){return h(function(e,t){return e.call(t)},arguments)},n.wbg.__wbg_codePointAt_78181f32881e5b59=function(e,t){return e.codePointAt(t>>>0)},n.wbg.__wbg_debug_3cb59063b29f58c1=function(e){console.debug(e)},n.wbg.__wbg_done_769e5ede4b31c67b=function(e){return e.done},n.wbg.__wbg_entries_3265d4158b33e5dc=function(e){return Object.entries(e)},n.wbg.__wbg_error_524f506f44df1645=function(e){console.error(e)},n.wbg.__wbg_error_7534b8e9a36f1ab4=function(e,t){let r,i;try{r=e,i=t,console.error(u(e,t))}finally{o.__wbindgen_free(r,i,1)}},n.wbg.__wbg_fromCodePoint_f37c25c172f2e8b5=function(){return h(function(e){return String.fromCodePoint(e>>>0)},arguments)},n.wbg.__wbg_get_67b2ba62fc30de12=function(){return h(function(e,t){return Reflect.get(e,t)},arguments)},n.wbg.__wbg_get_b9b93047fe3cf45b=function(e,t){return e[t>>>0]},n.wbg.__wbg_getwithrefkey_1dc361bd10053bfe=function(e,t){return e[t]},n.wbg.__wbg_info_3daf2e093e091b66=function(e){console.info(e)},n.wbg.__wbg_instanceof_ArrayBuffer_e14585432e3737fc=function(e){let t;try{t=e instanceof ArrayBuffer}catch{t=!1}return t},n.wbg.__wbg_instanceof_Map_f3469ce2244d2430=function(e){let t;try{t=e instanceof Map}catch{t=!1}return t},n.wbg.__wbg_instanceof_Uint8Array_17156bcf118086a9=function(e){let t;try{t=e instanceof Uint8Array}catch{t=!1}return t},n.wbg.__wbg_isArray_a1eab7e0d067391b=function(e){return Array.isArray(e)},n.wbg.__wbg_isSafeInteger_343e2beeeece1bb0=function(e){return Number.isSafeInteger(e)},n.wbg.__wbg_iterator_9a24c88df860dc65=function(){return Symbol.iterator},n.wbg.__wbg_length_a446193dc22c12f8=function(e){return e.length},n.wbg.__wbg_length_d56737991078581b=function(e){return e.length},n.wbg.__wbg_length_e2d2a49132c1b256=function(e){return e.length},n.wbg.__wbg_log_c222819a41e063d3=function(e){console.log(e)},n.wbg.__wbg_new_405e22f390576ce2=function(){return new Object},n.wbg.__wbg_new_5e0be73521bc8c17=function(){return new Map},n.wbg.__wbg_new_78feb108b6472713=function(){return new Array},n.wbg.__wbg_new_8a6f238a6ece86ea=function(){return new Error},n.wbg.__wbg_new_a12002a7f91c75be=function(e){return new Uint8Array(e)},n.wbg.__wbg_new_c68d7209be747379=function(e,t){return new Error(u(e,t))},n.wbg.__wbg_next_25feadfc0913fea9=function(e){return e.next},n.wbg.__wbg_next_6574e1a8a62d1055=function(){return h(function(e){return e.next()},arguments)},n.wbg.__wbg_set_37837023f3d740e8=function(e,t,r){e[t>>>0]=r},n.wbg.__wbg_set_3f1d0b984ed272ed=function(e,t,r){e[t]=r},n.wbg.__wbg_set_65595bdd868b3009=function(e,t,r){e.set(t,r>>>0)},n.wbg.__wbg_set_8fc6bf8a5b1071d1=function(e,t,r){return e.set(t,r)},n.wbg.__wbg_stack_0ed75d68575b0f3c=function(e,t){let r=t.stack,i=d(r,o.__wbindgen_malloc,o.__wbindgen_realloc),s=g;f().setInt32(e+4*1,s,!0),f().setInt32(e+4*0,i,!0)},n.wbg.__wbg_value_cd1ffa7b1ab794f1=function(e){return e.value},n.wbg.__wbg_warn_4ca3906c248c47c4=function(e){console.warn(e)},n.wbg.__wbindgen_as_number=function(e){return+e},n.wbg.__wbindgen_bigint_from_i64=function(e){return e},n.wbg.__wbindgen_bigint_from_u64=function(e){return BigInt.asUintN(64,e)},n.wbg.__wbindgen_bigint_get_as_i64=function(e,t){let r=t,i=typeof r=="bigint"?r:void 0;f().setBigInt64(e+8*1,m(i)?BigInt(0):i,!0),f().setInt32(e+4*0,!m(i),!0)},n.wbg.__wbindgen_boolean_get=function(e){let t=e;return typeof t=="boolean"?t?1:0:2},n.wbg.__wbindgen_debug_string=function(e,t){let r=v(t),i=d(r,o.__wbindgen_malloc,o.__wbindgen_realloc),s=g;f().setInt32(e+4*1,s,!0),f().setInt32(e+4*0,i,!0)},n.wbg.__wbindgen_error_new=function(e,t){return new Error(u(e,t))},n.wbg.__wbindgen_in=function(e,t){return e in t},n.wbg.__wbindgen_init_externref_table=function(){let e=o.__wbindgen_export_4,t=e.grow(4);e.set(0,void 0),e.set(t+0,void 0),e.set(t+1,null),e.set(t+2,!0),e.set(t+3,!1)},n.wbg.__wbindgen_is_bigint=function(e){return typeof e=="bigint"},n.wbg.__wbindgen_is_function=function(e){return typeof e=="function"},n.wbg.__wbindgen_is_object=function(e){let t=e;return typeof t=="object"&&t!==null},n.wbg.__wbindgen_is_string=function(e){return typeof e=="string"},n.wbg.__wbindgen_is_undefined=function(e){return e===void 0},n.wbg.__wbindgen_jsval_eq=function(e,t){return e===t},n.wbg.__wbindgen_jsval_loose_eq=function(e,t){return e==t},n.wbg.__wbindgen_memory=function(){return o.memory},n.wbg.__wbindgen_number_get=function(e,t){let r=t,i=typeof r=="number"?r:void 0;f().setFloat64(e+8*1,m(i)?0:i,!0),f().setInt32(e+4*0,!m(i),!0)},n.wbg.__wbindgen_number_new=function(e){return e},n.wbg.__wbindgen_string_get=function(e,t){let r=t,i=typeof r=="string"?r:void 0;var s=m(i)?0:d(i,o.__wbindgen_malloc,o.__wbindgen_realloc),_=g;f().setInt32(e+4*1,_,!0),f().setInt32(e+4*0,s,!0)},n.wbg.__wbindgen_string_new=function(e,t){return u(e,t)},n.wbg.__wbindgen_throw=function(e,t){throw new Error(u(e,t))},n}function L(n,e){return o=n.exports,T.__wbindgen_wasm_module=e,w=null,p=null,o.__wbindgen_start(),o}async function T(n){if(o!==void 0)return o;typeof n<"u"&&(Object.getPrototypeOf(n)===Object.prototype?{module_or_path:n}=n:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof n>"u"&&(n=new URL("ruff_wasm_bg.wasm",R.url));let e=q();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));let{instance:t,module:r}=await F(await n,e);return L(t,r)}var O=T;var y=acode.require("settings"),M=acode.require("loader"),A=class{constructor(){y.value[l.id]?Object.prototype.hasOwnProperty.call(this.settings,"line_length")||(delete y.value[l.id],y.update(!1),this._saveSetting()):this._saveSetting()}_saveSetting(){y.value[l.id]={indent_style:"space",indent_width:4,line_length:88,line_ending:"auto",quote_style:"double",skip_magic_trailing_comma:!1,docstring_code_format:!1},y.update(!1)}async init(){await O({module_or_path:`${this.baseUrl}wasm/ruff_wasm_bg.wasm`}),this.workspace=this.createWorkspace(),acode.registerFormatter(l.id,["py","pyi","pyx","pxd","pxi","rpy"],this.format.bind(this))}async format(){try{let{editor:e,activeFile:t}=editorManager;if(!t||!e)return;let{session:r}=e,i=e.getValue();M.showTitleLoader();try{let s=this.workspace?.check(i);if(s&&s.length>0){r.clearAnnotations();let a=s.map(c=>({row:c.start_location.row-1,column:c.start_location.column,text:`${c.code}: ${c.message}`,type:"error"}));r.setAnnotations(a)}let _=this.workspace.format(i);this.setValueToEditor(r,_)}catch(s){acode.alert("Ruff Plugin",`Format failed: ${s.message}`)}}finally{M.removeTitleLoader()}}createWorkspace(){return new S({"line-length":this.settings.line_length,"indent-width":this.settings.indent_width,format:{"indent-style":this.settings.indent_style,"quote-style":this.settings.quote_style,"line-ending":this.settings.line_ending,"skip-magic-trailing-comma":this.settings.skip_magic_trailing_comma,"docstring-code-format":this.settings.docstring_code_format}})}setValueToEditor(e,t){let{$undoStack:r,$redoStack:i,$rev:s,$mark:_}=Object.assign({},e.getUndoManager());e.setValue(t);let a=e.getUndoManager();a.$undoStack=r,a.$redoStack=i,a.$rev=s,a.$mark=_}async destroy(){this.workspace&&this.workspace.free(),acode.unregisterFormatter(l.id)}get settingsObj(){return{list:[{key:"indent_style",text:"Indent Style",value:this.settings.indent_style,info:"The style of indentation - space or tab",select:["space","tab"]},{key:"indent_width",text:"Indent Width",value:this.settings.indent_width,info:"Number of spaces per indentation level (default: 4)",prompt:"Indent Width",promptType:"number",promptOption:[{required:!0}]},{key:"line_length",text:"Line Length",value:this.settings.line_length,info:"Maximum allowed line length (default: 88)",prompt:"Line Length",promptType:"number",promptOption:[{required:!0}]},{key:"line_ending",text:"Line Ending",value:this.settings.line_ending,info:"Line ending style (default: auto)",select:["auto","lf","crlf","native"]},{key:"quote_style",text:"Quote Style",value:this.settings.quote_style,info:"The style of string quotes to use (default: double)",select:["double","single","preserve"]},{key:"skip_magic_trailing_comma",text:"Skip Magic Trailing Comma",value:this.settings.skip_magic_trailing_comma,checkbox:!!this.settings.skip_magic_trailing_comma,info:"Skip magic trailing comma handling"},{key:"docstring_code_format",text:"Format Docstring Code",value:this.settings.docstring_code_format,checkbox:!!this.settings.docstring_code_format,info:"Format code blocks in docstrings"}],cb:(e,t)=>{this.settings[e]=t,y.update(),this.workspace&&this.workspace.free(),this.workspace=this.createWorkspace()}}}get settings(){return y.value[l.id]}};if(window.acode){let n=new A;acode.setPluginInit(l.id,async(e,t,{cacheFileUrl:r,cacheFile:i})=>{e.endsWith("/")||(e+="/"),n.baseUrl=e,await n.init(t,i,r)},n.settingsObj),acode.setPluginUnmount(l.id,()=>{n.destroy()})}})();
